# 魔術方塊盲解訓練網頁 - 設計文檔

**日期：** 2026-02-11
**狀態：** 已批准
**版本：** 1.0.0

## 專案概述

創建一個網頁應用來訓練魔術方塊盲解（Blindsolve）的編碼記憶能力。應用包含自定義編碼系統、隨機打亂生成、3D 可視化魔術方塊，以及結構化的訓練模式。

## 核心需求

1. **自定義編碼系統**
   - 用戶可以完全自由定義每個塊的編碼（文字、符號、中文等）
   - 提供國際標準編碼（Speffz）作為預設，可一鍵套用

2. **打亂生成與歷史**
   - 隨機生成符合比賽規範的打亂公式
   - 自動計算對應的盲解編碼序列
   - 保存歷史記錄，可重複練習相同打亂

3. **3D 魔術方塊可視化**
   - 互動式 3D 魔術方塊，可旋轉查看
   - 編碼標註可切換顯示/隱藏
   - 側邊對照表，點擊可高亮對應塊

4. **雙模式訓練**
   - **自由模式**：隨時查看編碼，無限制練習
   - **訓練模式**：記憶 → 回憶 → 驗證的完整訓練流程

5. **響應式設計**
   - 支援桌面、平板、手機
   - 觸控優化

6. **本地儲存**
   - 所有資料存在瀏覽器 LocalStorage
   - 無需註冊登入

## 技術架構

### 技術棧

- **前端框架：** React 18+
- **3D 渲染：** React Three Fiber + Three.js + @react-three/drei
- **樣式：** Tailwind CSS
- **動畫：** react-spring 或 gsap
- **魔術方塊邏輯：** cubing.js 或 scrambo
- **狀態管理：** React Context + useReducer
- **建置工具：** Vite
- **語言：** TypeScript

### 整體架構方案

**方案 C：固定主畫面 + 彈性面板**

- 3D 魔術方塊永遠在主畫面（保持視覺連續性）
- 編碼設定用側邊滑出面板
- 訓練流程控制用底部面板
- 響應式友善：手機上面板可收合

## 元件架構

```
App
├── CubeScene (3D 主畫面，永遠可見)
│   ├── RubiksCube (3D 魔術方塊模型)
│   ├── CubeLabels (編碼標註層，可切換顯示/隱藏)
│   └── OrbitControls (視角控制)
│
├── EncodingPanel (側邊滑出面板)
│   ├── EncodingEditor (編輯每個塊的編碼)
│   └── PresetSelector (套用國際標準編碼)
│
├── ControlPanel (底部控制面板)
│   ├── ModeSwitch (自由模式 / 訓練模式切換)
│   ├── ScrambleGenerator (生成打亂按鈕)
│   └── HistoryList (歷史打亂記錄)
│
└── TrainingModal (訓練模式時的互動層)
    ├── MemoryPhase (記憶階段)
    ├── RecallPhase (回憶輸入)
    └── ResultPhase (驗證結果)
```

### 狀態管理

使用 React Context + useReducer 管理：
- 編碼設定
- 當前打亂狀態
- 訓練進度
- 歷史記錄

## 詳細設計

### 1. 3D 魔術方塊渲染

**結構：**
- 27 個小方塊（8 角塊 + 12 邊塊 + 6 中心塊 + 1 核心）
- 每個小方塊用 `<mesh>` + `<boxGeometry>`
- 6 個面各自對應一種顏色材質

**標註系統：**
- 使用 `<Html>` 或 `<Text>` 元件將編碼覆蓋在 3D 塊上
- 根據 `showLabels` 狀態切換顯示/隱藏
- 標註跟隨方塊 3D 轉換

**互動控制：**
- `<OrbitControls>` 支援拖曳旋轉、滾輪縮放
- 限制旋轉角度避免上下顛倒
- 桌面：滑鼠；手機：觸控

**動畫：**
- 套用打亂時使用 gsap 或 react-spring 做旋轉動畫
- 每個轉動步驟（R, U', F2）觸發對應面 90° 動畫

### 2. 編碼系統

**資料結構：**
```javascript
{
  corners: {
    'UBL': 'A', 'UBR': 'B', 'UFR': 'C', 'UFL': 'D',
    'DBL': 'E', 'DBR': 'F', 'DFR': 'G', 'DFL': 'H'
  },
  edges: {
    'UB': 'I', 'UR': 'J', 'UF': 'K', 'UL': 'L',
    'BL': 'M', 'BR': 'N', 'FR': 'O', 'FL': 'P',
    'DB': 'Q', 'DR': 'R', 'DF': 'S', 'DL': 'T'
  }
}
```

**預設編碼：**
- 提供 Speffz 編碼方案
- 用戶可一鍵套用或自行修改

**EncodingEditor：**
- 顯示魔術方塊展開圖或 3D 視角
- 每個塊旁有輸入框
- 支援 Tab 鍵快速輸入、Enter 儲存
- 即時預覽

**側邊對照表：**
- 分「角塊」和「邊塊」兩區
- 點擊編碼，3D 上對應塊高亮
- 手機上可收合成浮動按鈕

### 3. 打亂生成與歷史

**打亂生成：**
- 使用 `cubing.js` 或 `scrambo` 生成 20-25 步隨機打亂
- 顯示完整打亂公式
- 自動計算盲解編碼序列（角塊 + 邊塊）

**打亂套用流程：**
1. 點擊「生成新打亂」
2. 生成公式
3. 播放 3D 動畫（可跳過）
4. 計算打亂後狀態
5. 顯示編碼序列

**歷史記錄：**
```javascript
{
  history: [
    {
      id: 'uuid',
      timestamp: '2026-02-11T10:30:00Z',
      scramble: 'R U R\' U\' F2 D...',
      cornerSequence: 'ABC...',
      edgeSequence: 'IJK...',
      mode: 'free' | 'training',
      result: { /* 訓練成績 */ }
    }
  ]
}
```

- 儲存最近 50 筆
- 顯示日期、公式、結果
- 可重現任何歷史打亂
- 可刪除單筆或清空全部

### 4. 訓練模式流程

**自由模式（預設）：**
- 隨時可見編碼標註
- 自由旋轉、生成打亂、查看歷史
- 無計時或測驗

**訓練模式（三階段）：**

**階段 1：記憶 (Memory Phase)**
- 顯示打亂後的魔術方塊 + 完整編碼標註
- 顯示角塊/邊塊編碼序列
- 可自由旋轉查看
- 可選計時器
- 按鈕：「開始回憶」

**階段 2：回憶 (Recall Phase)**
- **隱藏所有編碼標註和序列**
- 3D 魔術方塊變為純色
- 輸入框：「角塊序列」「邊塊序列」
- 可選「顯示提示」（長度或前幾個字母）
- 按鈕：「提交答案」

**階段 3：驗證 (Result Phase)**
- 比對用戶輸入與正確答案
- 高亮：✓ 正確（綠色）、✗ 錯誤（紅色）
- 顯示正確率（角塊 8/8、邊塊 10/12）
- 可「查看正確答案」
- 按鈕：「再來一次」「回到自由模式」

### 5. 響應式設計

**斷點：**
- 桌面版：≥ 1024px
- 平板版：768px - 1023px
- 手機版：< 768px

**桌面版布局：**
```
┌─────────────────────────────────────┐
│   [Logo]  [模式切換]  [生成打亂]    │
├──────────┬──────────────────┬───────┤
│          │                  │       │
│ 編碼對照 │   3D 魔術方塊    │ 編碼  │
│   表     │   (主要區域)     │ 設定  │
│ (可收合) │                  │ 面板  │
│          │                  │(滑出) │
└──────────┴──────────────────┴───────┘
            ↑ 底部控制面板 ↑
```

**手機版布局：**
```
┌─────────────────┐
│   [≡] 標題      │
├─────────────────┤
│                 │
│  3D 魔術方塊    │
│  (全螢幕)       │
│                 │
├─────────────────┤
│ [打亂][設定][歷史]│
└─────────────────┘
```

**手機優化：**
- 編碼設定面板從底部滑出
- 對照表變為浮動按鈕
- 觸控拖曳、雙指縮放
- 訓練模式全螢幕，大輸入框
- 打亂公式橫向滑動

**效能考量：**
- 手機降低 3D 渲染品質
- 使用 `matchMedia` 動態調整
- 小螢幕上放大標註文字

### 6. LocalStorage 資料管理

**儲存結構：**
```javascript
{
  version: '1.0.0',

  encoding: {
    corners: { ... },
    edges: { ... }
  },

  settings: {
    showLabels: true,
    theme: 'light',
    animationSpeed: 1.0,
    historyLimit: 50
  },

  history: [ ... ],

  lastUpdated: '2026-02-11T10:30:00Z'
}
```

**同步策略：**
- 編碼修改後自動儲存（debounce 500ms）
- 訓練完成立即寫入歷史
- 歷史限制 50 筆（超過刪最舊）
- 讀取失敗使用預設值

**初始化：**
1. 啟動時讀取 localStorage
2. 首次使用套用 Speffz 預設
3. 舊版資料執行遷移
4. 首次顯示歡迎提示

**資料重置：**
- 設定中提供「重置所有資料」
- 顯示警告確認
- 清除所有資料回到初始狀態

### 7. 錯誤處理與 UX

**錯誤處理：**

- **LocalStorage 錯誤：**
  - 讀取失敗 → 使用預設，顯示提示
  - 寫入失敗 → 清理舊歷史，重試
  - 資料損壞 → 顯示錯誤，提供重置選項

- **3D 渲染錯誤：**
  - WebGL 不支援 → 顯示提示，建議現代瀏覽器
  - 效能過低 → 自動降低品質

- **打亂生成錯誤：**
  - 函式庫載入失敗 → 顯示錯誤，提供重新載入

**UX 優化：**

- **Loading 狀態：**
  - 首次載入 splash screen
  - 3D 載入骨架屏
  - 生成打亂顯示 spinner

- **互動回饋：**
  - 按鈕點擊 ripple effect
  - 儲存顯示 toast 訊息
  - 100% 正確率慶祝動畫

- **鍵盤快捷鍵（桌面）：**
  - `Space`：生成新打亂
  - `Tab`：切換標註顯示
  - `H`：開啟歷史
  - `E`：開啟編碼設定
  - `Esc`：關閉面板

- **輔助功能：**
  - 所有按鈕有 aria-label
  - 顏色對比符合 WCAG AA
  - 完整鍵盤操作支援

## 實作優先序

### Phase 1：核心功能（MVP）
1. 基本專案架構（React + Vite + TypeScript）
2. 3D 魔術方塊渲染（靜態）
3. 編碼系統與預設
4. 打亂生成與顯示
5. 自由模式

### Phase 2：完整功能
6. 編碼標註切換
7. 側邊對照表與高亮
8. 訓練模式流程
9. 歷史記錄
10. LocalStorage 整合

### Phase 3：優化與擴充
11. 響應式設計
12. 動畫與過場
13. 鍵盤快捷鍵
14. 錯誤處理完善
15. 效能優化

## 成功標準

- ✅ 用戶可以自定義並儲存編碼
- ✅ 可以生成隨機打亂並自動計算編碼序列
- ✅ 3D 魔術方塊可互動旋轉，標註清晰
- ✅ 訓練模式可完整進行記憶→回憶→驗證流程
- ✅ 在桌面和手機上都能流暢使用
- ✅ 資料可靠保存在本地，不會遺失

## 風險與注意事項

1. **3D 效能**：舊手機可能渲染較慢 → 需要效能降級方案
2. **編碼複雜度**：盲解演算法計算需準確 → 使用成熟函式庫
3. **觸控體驗**：手機上 3D 操作需優化 → 觸控手勢優化
4. **資料遺失**：LocalStorage 可能被清除 → 加入匯出/匯入功能（Phase 3）

## 未來擴充可能

- 匯出/匯入編碼設定檔
- 雲端帳號同步
- 統計與進度追蹤
- 支援其他尺寸魔術方塊（2x2, 4x4）
- 漸進式訓練模式
- 深色模式
- 多語言支援

---

**設計完成日期：** 2026-02-11
**設計者：** Claude Code
**核准者：** User
